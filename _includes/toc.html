<!-- Table of Contents -->
<link rel="stylesheet" href="/assets/css/toc.css"/>

{% if page.toc != false and content contains '<h2' or content contains '<h3' %}
<div class="toc-wrapper">
    <h4 class="toc-title">Table of Contents</h4>
    <nav id="toc" class="toc">
        <!-- TOC will be generated by JavaScript -->
    </nav>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const content = document.querySelector('.post-content');
    const toc = document.getElementById('toc');
    
    if (!content || !toc) return;
    
    const headings = content.querySelectorAll('h2, h3');
    if (headings.length === 0) {
        document.querySelector('.toc-wrapper').style.display = 'none';
        return;
    }
    
    let tocHTML = '<ul>';
    let currentLevel = 2;
    
    headings.forEach((heading, index) => {
        const level = parseInt(heading.tagName.substring(1));
        const text = heading.textContent;
        const id = heading.id || `heading-${index}`;
        
        if (!heading.id) {
            heading.id = id;
        }
        
        if (level > currentLevel) {
            tocHTML += '<ul>';
        } else if (level < currentLevel) {
            tocHTML += '</ul>';
        }
        
        tocHTML += `<li><a href="#${id}">${text}</a></li>`;
        currentLevel = level;
    });
    
    tocHTML += '</ul>';
    toc.innerHTML = tocHTML;
});
</script>
{% endif %}
